{% include 'convolution_neural_network' %}


BATCH_SIZE = 100

with tf.Session(config=config) as sess:
    init = tf.initialize_all_variables()
    sess.run(init)

    f = open(output_file_path, 'a')
    for _ in range(training_epoch):
        print('Training epoch{}'.format(_))
        for start in range(0, len(y_train), BATCH_SIZE):
            end = min(start + BATCH_SIZE, len(y_train))
            x_batch = x_train[start:end]
            y_batch = y_train[start:end]
            train_data = {X: x_batch, Y: y_batch, p_keep_conv: dropout_conv, p_keep_hidden: dropout_hidden}
            sess.run(train, feed_dict=train_data)
            print('Loss of batch{} : {}'.format(int(start / 100 + 1), sess.run(cost, feed_dict=train_data)), file=f)
    save_model(sess, sess_path)
